<p>After having numerous problems upgrading a Magento site 1.4.1.1 on a test server I decided to try and get it working locally before applying the fix(es) to the live server.</p>

<p>This is a fairly simple process and there&#8217;s <a href='http://blog.chandanweb.com/magento/how-to-change-base-url-in-magento'>lots</a> of <a href='http://www.magentocommerce.com/wiki/groups/227/moving_magento_to_another_server'>information</a> on how to do it. The key steps in the process are emptying magento&#8217;s cache directory and updating the base urls in the <code>core_config_data</code> table so that magento will generate correct urls.</p>
<!-- more -->
<p>When I setup my copy of the site locally I changed <code>local.xml</code> &amp; deleted the cache before modifying the db, just to make sure that magento was connecting ok.</p>

<p>Once that was done I went off to delete the new cache files from <code>siteroot/var/cache</code>.</p>

<p>Only, there weren&#8217;t any cache files. I took no note of it figuring magento had just decided not to cache the files and so proceeded to load the site, only for it to redirect me to the live site.</p>

<p>I spent the next few hours trying in vain to work out where magento was getting the idea that it should redirect to the main site. After wiping the db/files and re-extracting them several times I noticed that it was still redirecting even if the database was empty and the cache dir (var/cache) didn&#8217;t exist.</p>

<p>Obviously this is one helluva wtf, especially as there weren&#8217;t any references to the live site&#8217;s address in the files. The opinion on IRC was that somehow my local site was talking to the production site&#8217;s db and was using it&#8217;s database instead of my local one, however this couldn&#8217;t be the case as magento started complaining if I dropped the local database entirely.</p>

<p>In a last ditch attempt I tried grepping for the site&#8217;s address across the entire filesystem (using <code>grep -R &quot;sitedomain.com&quot; / </code>) and came across a load of files in <code>/tmp/magento</code>. After deleting the directory magento started working perfectly again, though it continued to store cache files in <code>/tmp/magento</code> rather than <code>var/cache/</code> for some reason.cache files in <code>/tmp/magento</code> rather than <code>var/cache/</code> for some reason.</p>